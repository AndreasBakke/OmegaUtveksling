const ***REMOVED***dirname} = require('path')
const ***REMOVED***findMade, findMadeSync} = require('./find-made.js')
const ***REMOVED***mkdirpManual, mkdirpManualSync} = require('./mkdirp-manual.js')

const mkdirpNative = (path, opts) => ***REMOVED***
  opts.recursive = true
  const parent = dirname(path)
  if (parent === path)
    return opts.mkdirAsync(path, opts)

  return findMade(opts, path).then(made =>
    opts.mkdirAsync(path, opts).then(() => made)
    .catch(er => ***REMOVED***
      if (er.code === 'ENOENT')
        return mkdirpManual(path, opts)
      else
        throw er
  ***REMOVED***))
}

const mkdirpNativeSync = (path, opts) => ***REMOVED***
  opts.recursive = true
  const parent = dirname(path)
  if (parent === path)
    return opts.mkdirSync(path, opts)

  const made = findMadeSync(opts, path)
  try ***REMOVED***
    opts.mkdirSync(path, opts)
    return made
***REMOVED*** catch (er) ***REMOVED***
    if (er.code === 'ENOENT')
      return mkdirpManualSync(path, opts)
    else
      throw er
***REMOVED***
}

module.exports = ***REMOVED***mkdirpNative, mkdirpNativeSync}
