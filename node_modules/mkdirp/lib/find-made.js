const ***REMOVED***dirname} = require('path')

const findMade = (opts, parent, path = undefined) => ***REMOVED***
  // we never want the 'made' return value to be a root directory
  if (path === parent)
    return Promise.resolve()

  return opts.statAsync(parent).then(
    st => st.isDirectory() ? path : undefined, // will fail later
    er => er.code === 'ENOENT'
      ? findMade(opts, dirname(parent), parent)
      : undefined
  )
}

const findMadeSync = (opts, parent, path = undefined) => ***REMOVED***
  if (path === parent)
    return undefined

  try ***REMOVED***
    return opts.statSync(parent).isDirectory() ? path : undefined
***REMOVED*** catch (er) ***REMOVED***
    return er.code === 'ENOENT'
      ? findMadeSync(opts, dirname(parent), parent)
      : undefined
***REMOVED***
}

module.exports = ***REMOVED***findMade, findMadeSync}
