"use strict";
Object.defineProperty(exports, "__esModule", ***REMOVED*** value: true });
exports.jwtDecrypt = void 0;
const decrypt_js_1 = require("../jwe/compact/decrypt.js");
const jwt_claims_set_js_1 = require("../lib/jwt_claims_set.js");
const errors_js_1 = require("../util/errors.js");
async function jwtDecrypt(jwt, key, options) ***REMOVED***
    const decrypted = await (0, decrypt_js_1.compactDecrypt)(jwt, key, options);
    const payload = (0, jwt_claims_set_js_1.default)(decrypted.protectedHeader, decrypted.plaintext, options);
    const ***REMOVED*** protectedHeader } = decrypted;
    if (protectedHeader.iss !== undefined && protectedHeader.iss !== payload.iss) ***REMOVED***
        throw new errors_js_1.JWTClaimValidationFailed('replicated "iss" claim header parameter mismatch', 'iss', 'mismatch');
  ***REMOVED***
    if (protectedHeader.sub !== undefined && protectedHeader.sub !== payload.sub) ***REMOVED***
        throw new errors_js_1.JWTClaimValidationFailed('replicated "sub" claim header parameter mismatch', 'sub', 'mismatch');
  ***REMOVED***
    if (protectedHeader.aud !== undefined &&
        JSON.stringify(protectedHeader.aud) !== JSON.stringify(payload.aud)) ***REMOVED***
        throw new errors_js_1.JWTClaimValidationFailed('replicated "aud" claim header parameter mismatch', 'aud', 'mismatch');
  ***REMOVED***
    const result = ***REMOVED*** payload, protectedHeader };
    if (typeof key === 'function') ***REMOVED***
        return ***REMOVED*** ...result, key: decrypted.key };
  ***REMOVED***
    return result;
}
exports.jwtDecrypt = jwtDecrypt;
