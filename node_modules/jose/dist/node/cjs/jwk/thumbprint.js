"use strict";
Object.defineProperty(exports, "__esModule", ***REMOVED*** value: true });
exports.calculateJwkThumbprintUri = exports.calculateJwkThumbprint = void 0;
const digest_js_1 = require("../runtime/digest.js");
const base64url_js_1 = require("../runtime/base64url.js");
const errors_js_1 = require("../util/errors.js");
const buffer_utils_js_1 = require("../lib/buffer_utils.js");
const is_object_js_1 = require("../lib/is_object.js");
const check = (value, description) => ***REMOVED***
    if (typeof value !== 'string' || !value) ***REMOVED***
        throw new errors_js_1.JWKInvalid(`$***REMOVED***description} missing or invalid`);
  ***REMOVED***
};
async function calculateJwkThumbprint(jwk, digestAlgorithm) ***REMOVED***
    if (!(0, is_object_js_1.default)(jwk)) ***REMOVED***
        throw new TypeError('JWK must be an object');
  ***REMOVED***
    digestAlgorithm !== null && digestAlgorithm !== void 0 ? digestAlgorithm : (digestAlgorithm = 'sha256');
    if (digestAlgorithm !== 'sha256' &&
        digestAlgorithm !== 'sha384' &&
        digestAlgorithm !== 'sha512') ***REMOVED***
        throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');
  ***REMOVED***
    let components;
    switch (jwk.kty) ***REMOVED***
        case 'EC':
            check(jwk.crv, '"crv" (Curve) Parameter');
            check(jwk.x, '"x" (X Coordinate) Parameter');
            check(jwk.y, '"y" (Y Coordinate) Parameter');
            components = ***REMOVED*** crv: jwk.crv, kty: jwk.kty, x: jwk.x, y: jwk.y };
            break;
        case 'OKP':
            check(jwk.crv, '"crv" (Subtype of Key Pair) Parameter');
            check(jwk.x, '"x" (Public Key) Parameter');
            components = ***REMOVED*** crv: jwk.crv, kty: jwk.kty, x: jwk.x };
            break;
        case 'RSA':
            check(jwk.e, '"e" (Exponent) Parameter');
            check(jwk.n, '"n" (Modulus) Parameter');
            components = ***REMOVED*** e: jwk.e, kty: jwk.kty, n: jwk.n };
            break;
        case 'oct':
            check(jwk.k, '"k" (Key Value) Parameter');
            components = ***REMOVED*** k: jwk.k, kty: jwk.kty };
            break;
        default:
            throw new errors_js_1.JOSENotSupported('"kty" (Key Type) Parameter missing or unsupported');
  ***REMOVED***
    const data = buffer_utils_js_1.encoder.encode(JSON.stringify(components));
    return (0, base64url_js_1.encode)(await (0, digest_js_1.default)(digestAlgorithm, data));
}
exports.calculateJwkThumbprint = calculateJwkThumbprint;
async function calculateJwkThumbprintUri(jwk, digestAlgorithm) ***REMOVED***
    digestAlgorithm !== null && digestAlgorithm !== void 0 ? digestAlgorithm : (digestAlgorithm = 'sha256');
    const thumbprint = await calculateJwkThumbprint(jwk, digestAlgorithm);
    return `urn:ietf:params:oauth:jwk-thumbprint:sha-$***REMOVED***digestAlgorithm.slice(-3)}:$***REMOVED***thumbprint}`;
}
exports.calculateJwkThumbprintUri = calculateJwkThumbprintUri;
