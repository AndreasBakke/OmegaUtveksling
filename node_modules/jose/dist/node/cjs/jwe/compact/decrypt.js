"use strict";
Object.defineProperty(exports, "__esModule", ***REMOVED*** value: true });
exports.compactDecrypt = void 0;
const decrypt_js_1 = require("../flattened/decrypt.js");
const errors_js_1 = require("../../util/errors.js");
const buffer_utils_js_1 = require("../../lib/buffer_utils.js");
async function compactDecrypt(jwe, key, options) ***REMOVED***
    if (jwe instanceof Uint8Array) ***REMOVED***
        jwe = buffer_utils_js_1.decoder.decode(jwe);
  ***REMOVED***
    if (typeof jwe !== 'string') ***REMOVED***
        throw new errors_js_1.JWEInvalid('Compact JWE must be a string or Uint8Array');
  ***REMOVED***
    const ***REMOVED*** 0: protectedHeader, 1: encryptedKey, 2: iv, 3: ciphertext, 4: tag, length, } = jwe.split('.');
    if (length !== 5) ***REMOVED***
        throw new errors_js_1.JWEInvalid('Invalid Compact JWE');
  ***REMOVED***
    const decrypted = await (0, decrypt_js_1.flattenedDecrypt)(***REMOVED***
        ciphertext,
        iv: (iv || undefined),
        protected: protectedHeader || undefined,
        tag: (tag || undefined),
        encrypted_key: encryptedKey || undefined,
  ***REMOVED***, key, options);
    const result = ***REMOVED*** plaintext: decrypted.plaintext, protectedHeader: decrypted.protectedHeader };
    if (typeof key === 'function') ***REMOVED***
        return ***REMOVED*** ...result, key: decrypted.key };
  ***REMOVED***
    return result;
}
exports.compactDecrypt = compactDecrypt;
