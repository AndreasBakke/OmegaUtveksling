import ***REMOVED*** flattenedDecrypt } from '../flattened/decrypt.js';
import ***REMOVED*** JWEInvalid } from '../../util/errors.js';
import ***REMOVED*** decoder } from '../../lib/buffer_utils.js';
export async function compactDecrypt(jwe, key, options) ***REMOVED***
    if (jwe instanceof Uint8Array) ***REMOVED***
        jwe = decoder.decode(jwe);
  ***REMOVED***
    if (typeof jwe !== 'string') ***REMOVED***
        throw new JWEInvalid('Compact JWE must be a string or Uint8Array');
  ***REMOVED***
    const ***REMOVED*** 0: protectedHeader, 1: encryptedKey, 2: iv, 3: ciphertext, 4: tag, length, } = jwe.split('.');
    if (length !== 5) ***REMOVED***
        throw new JWEInvalid('Invalid Compact JWE');
  ***REMOVED***
    const decrypted = await flattenedDecrypt(***REMOVED***
        ciphertext,
        iv: (iv || undefined),
        protected: protectedHeader || undefined,
        tag: (tag || undefined),
        encrypted_key: encryptedKey || undefined,
  ***REMOVED***, key, options);
    const result = ***REMOVED*** plaintext: decrypted.plaintext, protectedHeader: decrypted.protectedHeader };
    if (typeof key === 'function') ***REMOVED***
        return ***REMOVED*** ...result, key: decrypted.key };
  ***REMOVED***
    return result;
}
