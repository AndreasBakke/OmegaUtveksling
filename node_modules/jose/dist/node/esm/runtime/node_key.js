import ***REMOVED*** constants } from 'crypto';
import getNamedCurve from './get_named_curve.js';
import ***REMOVED*** JOSENotSupported } from '../util/errors.js';
import checkModulusLength from './check_modulus_length.js';
import ***REMOVED*** rsaPssParams } from './flags.js';
const PSS = ***REMOVED***
    padding: constants.RSA_PKCS1_PSS_PADDING,
    saltLength: constants.RSA_PSS_SALTLEN_DIGEST,
};
const ecCurveAlgMap = new Map([
    ['ES256', 'P-256'],
    ['ES256K', 'secp256k1'],
    ['ES384', 'P-384'],
    ['ES512', 'P-521'],
]);
export default function keyForCrypto(alg, key) ***REMOVED***
    switch (alg) ***REMOVED***
        case 'EdDSA':
            if (!['ed25519', 'ed448'].includes(key.asymmetricKeyType)) ***REMOVED***
                throw new TypeError('Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448');
          ***REMOVED***
            return key;
        case 'RS256':
        case 'RS384':
        case 'RS512':
            if (key.asymmetricKeyType !== 'rsa') ***REMOVED***
                throw new TypeError('Invalid key for this operation, its asymmetricKeyType must be rsa');
          ***REMOVED***
            checkModulusLength(key, alg);
            return key;
        case rsaPssParams && 'PS256':
        case rsaPssParams && 'PS384':
        case rsaPssParams && 'PS512':
            if (key.asymmetricKeyType === 'rsa-pss') ***REMOVED***
                const ***REMOVED*** hashAlgorithm, mgf1HashAlgorithm, saltLength } = key.asymmetricKeyDetails;
                const length = parseInt(alg.slice(-3), 10);
                if (hashAlgorithm !== undefined &&
                    (hashAlgorithm !== `sha$***REMOVED***length}` || mgf1HashAlgorithm !== hashAlgorithm)) ***REMOVED***
                    throw new TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" $***REMOVED***alg}`);
              ***REMOVED***
                if (saltLength !== undefined && saltLength > length >> 3) ***REMOVED***
                    throw new TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" $***REMOVED***alg}`);
              ***REMOVED***
          ***REMOVED***
            else if (key.asymmetricKeyType !== 'rsa') ***REMOVED***
                throw new TypeError('Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss');
          ***REMOVED***
            checkModulusLength(key, alg);
            return ***REMOVED*** key, ...PSS };
        case !rsaPssParams && 'PS256':
        case !rsaPssParams && 'PS384':
        case !rsaPssParams && 'PS512':
            if (key.asymmetricKeyType !== 'rsa') ***REMOVED***
                throw new TypeError('Invalid key for this operation, its asymmetricKeyType must be rsa');
          ***REMOVED***
            checkModulusLength(key, alg);
            return ***REMOVED*** key, ...PSS };
        case 'ES256':
        case 'ES256K':
        case 'ES384':
        case 'ES512': ***REMOVED***
            if (key.asymmetricKeyType !== 'ec') ***REMOVED***
                throw new TypeError('Invalid key for this operation, its asymmetricKeyType must be ec');
          ***REMOVED***
            const actual = getNamedCurve(key);
            const expected = ecCurveAlgMap.get(alg);
            if (actual !== expected) ***REMOVED***
                throw new TypeError(`Invalid key curve for the algorithm, its curve must be $***REMOVED***expected}, got $***REMOVED***actual}`);
          ***REMOVED***
            return ***REMOVED*** dsaEncoding: 'ieee-p1363', key };
      ***REMOVED***
        default:
            throw new JOSENotSupported(`alg $***REMOVED***alg} is not supported either by JOSE or your javascript runtime`);
  ***REMOVED***
}
