import ***REMOVED*** compactVerify } from '../jws/compact/verify.js';
import jwtPayload from '../lib/jwt_claims_set.js';
import ***REMOVED*** JWTInvalid } from '../util/errors.js';
export async function jwtVerify(jwt, key, options) ***REMOVED***
    var _a;
    const verified = await compactVerify(jwt, key, options);
    if (((_a = verified.protectedHeader.crit) === null || _a === void 0 ? void 0 : _a.includes('b64')) && verified.protectedHeader.b64 === false) ***REMOVED***
        throw new JWTInvalid('JWTs MUST NOT use unencoded payload');
  ***REMOVED***
    const payload = jwtPayload(verified.protectedHeader, verified.payload, options);
    const result = ***REMOVED*** payload, protectedHeader: verified.protectedHeader };
    if (typeof key === 'function') ***REMOVED***
        return ***REMOVED*** ...result, key: verified.key };
  ***REMOVED***
    return result;
}
