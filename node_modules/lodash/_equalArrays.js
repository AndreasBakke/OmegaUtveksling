var SetCache = require('./_SetCache'),
    arraySome = require('./_arraySome'),
    cacheHas = require('./_cacheHas');

/** Used to compose bitmasks for value comparisons. */
var COMPARE_PARTIAL_FLAG = 1,
    COMPARE_UNORDERED_FLAG = 2;

/**
 * A specialized version of `baseIsEqualDeep` for arrays with support for
 * partial deep comparisons.
 *
 * @private
 * @param ***REMOVED***Array} array The array to compare.
 * @param ***REMOVED***Array} other The other array to compare.
 * @param ***REMOVED***number} bitmask The bitmask flags. See `baseIsEqual` for more details.
 * @param ***REMOVED***Function} customizer The function to customize comparisons.
 * @param ***REMOVED***Function} equalFunc The function to determine equivalents of values.
 * @param ***REMOVED***Object} stack Tracks traversed `array` and `other` objects.
 * @returns ***REMOVED***boolean} Returns `true` if the arrays are equivalent, else `false`.
 */
function equalArrays(array, other, bitmask, customizer, equalFunc, stack) ***REMOVED***
  var isPartial = bitmask & COMPARE_PARTIAL_FLAG,
      arrLength = array.length,
      othLength = other.length;

  if (arrLength != othLength && !(isPartial && othLength > arrLength)) ***REMOVED***
    return false;
***REMOVED***
  // Check that cyclic values are equal.
  var arrStacked = stack.get(array);
  var othStacked = stack.get(other);
  if (arrStacked && othStacked) ***REMOVED***
    return arrStacked == other && othStacked == array;
***REMOVED***
  var index = -1,
      result = true,
      seen = (bitmask & COMPARE_UNORDERED_FLAG) ? new SetCache : undefined;

  stack.set(array, other);
  stack.set(other, array);

  // Ignore non-index properties.
  while (++index < arrLength) ***REMOVED***
    var arrValue = array[index],
        othValue = other[index];

    if (customizer) ***REMOVED***
      var compared = isPartial
        ? customizer(othValue, arrValue, index, other, array, stack)
        : customizer(arrValue, othValue, index, array, other, stack);
  ***REMOVED***
    if (compared !== undefined) ***REMOVED***
      if (compared) ***REMOVED***
        continue;
    ***REMOVED***
      result = false;
      break;
  ***REMOVED***
    // Recursively compare arrays (susceptible to call stack limits).
    if (seen) ***REMOVED***
      if (!arraySome(other, function(othValue, othIndex) ***REMOVED***
            if (!cacheHas(seen, othIndex) &&
                (arrValue === othValue || equalFunc(arrValue, othValue, bitmask, customizer, stack))) ***REMOVED***
              return seen.push(othIndex);
          ***REMOVED***
        ***REMOVED***)) ***REMOVED***
        result = false;
        break;
    ***REMOVED***
  ***REMOVED*** else if (!(
          arrValue === othValue ||
            equalFunc(arrValue, othValue, bitmask, customizer, stack)
        )) ***REMOVED***
      result = false;
      break;
  ***REMOVED***
***REMOVED***
  stack['delete'](array);
  stack['delete'](other);
  return result;
}

module.exports = equalArrays;
