// Limited implementation of python % string operator, supports only %s and %r for now
// (other formats are not used here, but may appear in custom templates)

'use strict'

const ***REMOVED*** inspect } = require('util')


module.exports = function sub(pattern, ...values) ***REMOVED***
    let regex = /%(?:(%)|(-)?(\*)?(?:\((\w+)\))?([A-Za-z]))/g

    let result = pattern.replace(regex, function (_, is_literal, is_left_align, is_padded, name, format) ***REMOVED***
        if (is_literal) return '%'

        let padded_count = 0
        if (is_padded) ***REMOVED***
            if (values.length === 0) throw new TypeError('not enough arguments for format string')
            padded_count = values.shift()
            if (!Number.isInteger(padded_count)) throw new TypeError('* wants int')
      ***REMOVED***

        let str
        if (name !== undefined) ***REMOVED***
            let dict = values[0]
            if (typeof dict !== 'object' || dict === null) throw new TypeError('format requires a mapping')
            if (!(name in dict)) throw new TypeError(`no such key: '$***REMOVED***name}'`)
            str = dict[name]
      ***REMOVED*** else ***REMOVED***
            if (values.length === 0) throw new TypeError('not enough arguments for format string')
            str = values.shift()
      ***REMOVED***

        switch (format) ***REMOVED***
            case 's':
                str = String(str)
                break
            case 'r':
                str = inspect(str)
                break
            case 'd':
            case 'i':
                if (typeof str !== 'number') ***REMOVED***
                    throw new TypeError(`%$***REMOVED***format} format: a number is required, not $***REMOVED***typeof str}`)
              ***REMOVED***
                str = String(str.toFixed(0))
                break
            default:
                throw new TypeError(`unsupported format character '$***REMOVED***format}'`)
      ***REMOVED***

        if (padded_count > 0) ***REMOVED***
            return is_left_align ? str.padEnd(padded_count) : str.padStart(padded_count)
      ***REMOVED*** else ***REMOVED***
            return str
      ***REMOVED***
  ***REMOVED***)

    if (values.length) ***REMOVED***
        if (values.length === 1 && typeof values[0] === 'object' && values[0] !== null) ***REMOVED***
            // mapping
      ***REMOVED*** else ***REMOVED***
            throw new TypeError('not all arguments converted during string formatting')
      ***REMOVED***
  ***REMOVED***

    return result
}
