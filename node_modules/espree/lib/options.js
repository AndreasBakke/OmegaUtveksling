/**
 * @fileoverview A collection of methods for processing Espree's options.
 * @author Kai Cataldo
 */

//------------------------------------------------------------------------------
// Helpers
//------------------------------------------------------------------------------

const SUPPORTED_VERSIONS = [
    3,
    5,
    6, // 2015
    7, // 2016
    8, // 2017
    9, // 2018
    10, // 2019
    11, // 2020
    12, // 2021
    13, // 2022
    14 // 2023
];

/**
 * Get the latest ECMAScript version supported by Espree.
 * @returns ***REMOVED***number} The latest ECMAScript version.
 */
export function getLatestEcmaVersion() ***REMOVED***
    return SUPPORTED_VERSIONS[SUPPORTED_VERSIONS.length - 1];
}

/**
 * Get the list of ECMAScript versions supported by Espree.
 * @returns ***REMOVED***number[]} An array containing the supported ECMAScript versions.
 */
export function getSupportedEcmaVersions() ***REMOVED***
    return [...SUPPORTED_VERSIONS];
}

/**
 * Normalize ECMAScript version from the initial config
 * @param ***REMOVED***(number|"latest")} ecmaVersion ECMAScript version from the initial config
 * @throws ***REMOVED***Error} throws an error if the ecmaVersion is invalid.
 * @returns ***REMOVED***number} normalized ECMAScript version
 */
function normalizeEcmaVersion(ecmaVersion = 5) ***REMOVED***

    let version = ecmaVersion === "latest" ? getLatestEcmaVersion() : ecmaVersion;

    if (typeof version !== "number") ***REMOVED***
        throw new Error(`ecmaVersion must be a number or "latest". Received value of type $***REMOVED***typeof ecmaVersion} instead.`);
  ***REMOVED***

    // Calculate ECMAScript edition number from official year version starting with
    // ES2015, which corresponds with ES6 (or a difference of 2009).
    if (version >= 2015) ***REMOVED***
        version -= 2009;
  ***REMOVED***

    if (!SUPPORTED_VERSIONS.includes(version)) ***REMOVED***
        throw new Error("Invalid ecmaVersion.");
  ***REMOVED***

    return version;
}

/**
 * Normalize sourceType from the initial config
 * @param ***REMOVED***string} sourceType to normalize
 * @throws ***REMOVED***Error} throw an error if sourceType is invalid
 * @returns ***REMOVED***string} normalized sourceType
 */
function normalizeSourceType(sourceType = "script") ***REMOVED***
    if (sourceType === "script" || sourceType === "module") ***REMOVED***
        return sourceType;
  ***REMOVED***

    if (sourceType === "commonjs") ***REMOVED***
        return "script";
  ***REMOVED***

    throw new Error("Invalid sourceType.");
}

/**
 * Normalize parserOptions
 * @param ***REMOVED***Object} options the parser options to normalize
 * @throws ***REMOVED***Error} throw an error if found invalid option.
 * @returns ***REMOVED***Object} normalized options
 */
export function normalizeOptions(options) ***REMOVED***
    const ecmaVersion = normalizeEcmaVersion(options.ecmaVersion);
    const sourceType = normalizeSourceType(options.sourceType);
    const ranges = options.range === true;
    const locations = options.loc === true;

    if (ecmaVersion !== 3 && options.allowReserved) ***REMOVED***

        // a value of `false` is intentionally allowed here, so a shared config can overwrite it when needed
        throw new Error("`allowReserved` is only supported when ecmaVersion is 3");
  ***REMOVED***
    if (typeof options.allowReserved !== "undefined" && typeof options.allowReserved !== "boolean") ***REMOVED***
        throw new Error("`allowReserved`, when present, must be `true` or `false`");
  ***REMOVED***
    const allowReserved = ecmaVersion === 3 ? (options.allowReserved || "never") : false;
    const ecmaFeatures = options.ecmaFeatures || ***REMOVED***};
    const allowReturnOutsideFunction = options.sourceType === "commonjs" ||
        Boolean(ecmaFeatures.globalReturn);

    if (sourceType === "module" && ecmaVersion < 6) ***REMOVED***
        throw new Error("sourceType 'module' is not supported when ecmaVersion < 2015. Consider adding `***REMOVED*** ecmaVersion: 2015 }` to the parser options.");
  ***REMOVED***

    return Object.assign(***REMOVED***}, options, ***REMOVED***
        ecmaVersion,
        sourceType,
        ranges,
        locations,
        allowReserved,
        allowReturnOutsideFunction
  ***REMOVED***);
}
