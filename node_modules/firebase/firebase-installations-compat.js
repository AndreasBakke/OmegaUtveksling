!function(t,e)***REMOVED***"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase,t.firebase.INTERNAL.modularAPIs)}(this,function(It,St)***REMOVED***"use strict";try***REMOVED***!(function()***REMOVED***function t(t)***REMOVED***return t&&"object"==typeof t&&"default"in t?t:***REMOVED***default:t}}var r,e=t(It);class o extends Error***REMOVED***constructor(t,e,n)***REMOVED***super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,o.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,a.prototype.create)}}class a***REMOVED***constructor(t,e,n)***REMOVED***this.service=t,this.serviceName=e,this.errors=n}create(t,...e)***REMOVED***var r,n=e[0]||***REMOVED***},a=`$***REMOVED***this.service}/$***REMOVED***t}`,i=this.errors[t],i=i?(r=n,i.replace(s,(t,e)=>***REMOVED***var n=r[e];return null!=n?String(n):`<$***REMOVED***e}?>`})):"Error",i=`$***REMOVED***this.serviceName}: $***REMOVED***i} ($***REMOVED***a}).`;return new o(a,i,n)}}const s=/\***REMOVED***\$([^}]+)}/g;class n***REMOVED***constructor(t,e,n)***REMOVED***this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps=***REMOVED***},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t)***REMOVED***return this.instantiationMode=t,this}setMultipleInstances(t)***REMOVED***return this.multipleInstances=t,this}setServiceProps(t)***REMOVED***return this.serviceProps=t,this}setInstanceCreatedCallback(t)***REMOVED***return this.onInstanceCreated=t,this}}const c=(e,t)=>t.some(t=>e instanceof t);let u,i;const f=new WeakMap,p=new WeakMap,d=new WeakMap,l=new WeakMap,g=new WeakMap;let h=***REMOVED***get(t,e,n)***REMOVED***if(t instanceof IDBTransaction)***REMOVED***if("done"===e)return p.get(t);if("objectStoreNames"===e)return t.objectStoreNames||d.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(t[e])},set(t,e,n)***REMOVED***return t[e]=n,!0},has(t,e)***REMOVED***return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function v(r)***REMOVED***return r!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i=i||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(r)?function(...t)***REMOVED***return r.apply(y(this),t),m(f.get(this))}:function(...t)***REMOVED***return m(r.apply(y(this),t))}:function(t,...e)***REMOVED***var n=r.call(y(this),t,...e);return d.set(n,t.sort?t.sort():[t]),m(n)}}function w(t)***REMOVED***return"function"==typeof t?v(t):(t instanceof IDBTransaction&&(i=t,p.has(i)||(e=new Promise((t,e)=>***REMOVED***const n=()=>***REMOVED***i.removeEventListener("complete",r),i.removeEventListener("error",a),i.removeEventListener("abort",a)},r=()=>***REMOVED***t(),n()},a=()=>***REMOVED***e(i.error||new DOMException("AbortError","AbortError")),n()};i.addEventListener("complete",r),i.addEventListener("error",a),i.addEventListener("abort",a)}),p.set(i,e))),c(t,u=u||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(t,h):t);var i,e}function m(t)***REMOVED***if(t instanceof IDBRequest)return function(i)***REMOVED***const t=new Promise((t,e)=>***REMOVED***const n=()=>***REMOVED***i.removeEventListener("success",r),i.removeEventListener("error",a)},r=()=>***REMOVED***t(m(i.result)),n()},a=()=>***REMOVED***e(i.error),n()};i.addEventListener("success",r),i.addEventListener("error",a)});return t.then(t=>***REMOVED***t instanceof IDBCursor&&f.set(t,i)}).catch(()=>***REMOVED***}),g.set(t,i),t}(t);if(l.has(t))return l.get(t);var e=w(t);return e!==t&&(l.set(t,e),g.set(e,t)),e}const y=t=>g.get(t);const b=["get","getKey","getAll","getAllKeys","count"],I=["put","add","delete","clear"],S=new Map;function C(t,e)***REMOVED***if(t instanceof IDBDatabase&&!(e in t)&&"string"==typeof e)***REMOVED***if(S.get(e))return S.get(e);const a=e.replace(/FromIndex$/,""),i=e!==a,o=I.includes(a);if(a in(i?IDBIndex:IDBObjectStore).prototype&&(o||b.includes(a)))***REMOVED***var n=async function(t,...e)***REMOVED***var n=this.transaction(t,o?"readwrite":"readonly");let r=n.store;return i&&(r=r.index(e.shift())),(await Promise.all([r[a](...e),o&&n.done]))[0]};return S.set(e,n),n}}}h=***REMOVED***...r=h,get:(t,e,n)=>C(t,e)||r.get(t,e,n),has:(t,e)=>!!C(t,e)||r.has(t,e)};var T="@firebase/installations",k="0.6.1";const E=1e4,j=`w:$***REMOVED***k}`,D="FIS_v2",P="https://firebaseinstallations.googleapis.com/v1",$=36e5;var B;const L=new a("installations","Installations",***REMOVED***"missing-app-config-values":'Missing App configuration value: "***REMOVED***$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'***REMOVED***$requestName} request failed with error "***REMOVED***$serverCode} ***REMOVED***$serverStatus}: ***REMOVED***$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function q(t)***REMOVED***return t instanceof o&&t.code.includes("request-failed")}function N(***REMOVED***projectId:t})***REMOVED***return`$***REMOVED***P}/projects/$***REMOVED***t}/installations`}function O(t)***REMOVED***return***REMOVED***token:t.token,requestStatus:2,expiresIn:(t=t.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()}}async function A(t,e)***REMOVED***var n=(await e.json()).error;return L.create("request-failed",***REMOVED***requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function M(***REMOVED***apiKey:t})***REMOVED***return new Headers(***REMOVED***"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function x(t,***REMOVED***refreshToken:e})***REMOVED***const n=M(t);return n.append("Authorization",(e=e,`$***REMOVED***D} $***REMOVED***e}`)),n}async function _(t)***REMOVED***var e=await t();return 500<=e.status&&e.status<600?t():e}function V(e)***REMOVED***return new Promise(t=>***REMOVED***setTimeout(t,e)})}const F=/^[cdef][\w-]***REMOVED***21}$/,K="";function H()***REMOVED***try***REMOVED***const e=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(e),e[0]=112+e[0]%16;var t=function(t)***REMOVED***const e=function(t)***REMOVED***const e=btoa(String.fromCharCode(...t));return e.replace(/\+/g,"-").replace(/\//g,"_")}(t);return e.substr(0,22)}(e);return F.test(t)?t:K}catch(t)***REMOVED***return K}}function R(t)***REMOVED***return`$***REMOVED***t.appName}!$***REMOVED***t.appId}`}const W=new Map;function z(t,e)***REMOVED***var n=R(t);U(n,e),function(t,e)***REMOVED***const n=G();n&&n.postMessage(***REMOVED***key:t,fid:e});Y()}(n,e)}function U(t,e)***REMOVED***var n=W.get(t);if(n)for(const r of n)r(e)}let J=null;function G()***REMOVED***return!J&&"BroadcastChannel"in self&&(J=new BroadcastChannel("[Firebase] FID Change"),J.onmessage=t=>***REMOVED***U(t.data.key,t.data.fid)}),J}function Y()***REMOVED***0===W.size&&J&&(J.close(),J=null)}const Z="firebase-installations-database",Q=1,X="firebase-installations-store";let tt=null;function et()***REMOVED***return tt=tt||function(t,e,***REMOVED***blocked:n,upgrade:r,blocking:a,terminated:i})***REMOVED***const o=indexedDB.open(t,e),s=m(o);return r&&o.addEventListener("upgradeneeded",t=>***REMOVED***r(m(o.result),t.oldVersion,t.newVersion,m(o.transaction))}),n&&o.addEventListener("blocked",()=>n()),s.then(t=>***REMOVED***i&&t.addEventListener("close",()=>i()),a&&t.addEventListener("versionchange",()=>a())}).catch(()=>***REMOVED***}),s}(Z,Q,***REMOVED***upgrade:(t,e)=>***REMOVED***0===e&&t.createObjectStore(X)}}),tt}async function nt(t,e)***REMOVED***var n=R(t);const r=await et(),a=r.transaction(X,"readwrite"),i=a.objectStore(X);var o=await i.get(n);return await i.put(e,n),await a.done,o&&o.fid===e.fid||z(t,e.fid),e}async function rt(t)***REMOVED***var e=R(t);const n=await et(),r=n.transaction(X,"readwrite");await r.objectStore(X).delete(e),await r.done}async function at(t,e)***REMOVED***var n=R(t);const r=await et(),a=r.transaction(X,"readwrite"),i=a.objectStore(X);var o=await i.get(n),s=e(o);return void 0===s?await i.delete(n):await i.put(s,n),await a.done,!s||o&&o.fid===s.fid||z(t,s.fid),s}async function it(n)***REMOVED***let r;var t=await at(n.appConfig,t=>***REMOVED***var e=st(t||***REMOVED***fid:H(),registrationStatus:0}),e=function(t,e)***REMOVED******REMOVED***if(0!==e.registrationStatus)return 1===e.registrationStatus?***REMOVED***installationEntry:e,registrationPromise:async function(t)***REMOVED***let e=await ot(t.appConfig);for(;1===e.registrationStatus;)await V(100),e=await ot(t.appConfig);if(0!==e.registrationStatus)return e;***REMOVED***var***REMOVED***installationEntry:n,registrationPromise:r}=await it(t);return r||n}}(t)}:***REMOVED***installationEntry:e};if(!navigator.onLine)***REMOVED***var n=Promise.reject(L.create("app-offline"));return***REMOVED***installationEntry:e,registrationPromise:n}}var r=***REMOVED***fid:e.fid,registrationStatus:1,registrationTime:Date.now()},n=async function(e,n)***REMOVED***try***REMOVED***var t=await async function(***REMOVED***appConfig:t,heartbeatServiceProvider:e},***REMOVED***fid:n})***REMOVED***const r=N(t),a=M(t),i=e.getImmediate(***REMOVED***optional:!0});!i||(o=await i.getHeartbeatsHeader())&&a.append("x-firebase-client",o);var o=***REMOVED***fid:n,authVersion:D,appId:t.appId,sdkVersion:j};const s=***REMOVED***method:"POST",headers:a,body:JSON.stringify(o)},c=await _(()=>fetch(r,s));if(c.ok)***REMOVED***o=await c.json();return***REMOVED***fid:o.fid||n,registrationStatus:2,refreshToken:o.refreshToken,authToken:O(o.authToken)}}throw await A("Create Installation",c)}(e,n);return nt(e.appConfig,t)}catch(t)***REMOVED***throw q(t)&&409===t.customData.serverCode?await rt(e.appConfig):await nt(e.appConfig,***REMOVED***fid:n.fid,registrationStatus:0}),t}}(t,r);return***REMOVED***installationEntry:r,registrationPromise:n}}}(n,e);return r=e.registrationPromise,e.installationEntry});return t.fid===K?***REMOVED***installationEntry:await r}:***REMOVED***installationEntry:t,registrationPromise:r}}function ot(t)***REMOVED***return at(t,t=>***REMOVED***if(!t)throw L.create("installation-not-found");return st(t)})}function st(t)***REMOVED***return 1===(e=t).registrationStatus&&e.registrationTime+E<Date.now()?***REMOVED***fid:t.fid,registrationStatus:0}:t;var e}async function ct(***REMOVED***appConfig:t,heartbeatServiceProvider:e},n)***REMOVED***const r=([a,i]=[t,n["fid"]],`$***REMOVED***N(a)}/$***REMOVED***i}/authTokens:generate`);var a,i;const o=x(t,n),s=e.getImmediate(***REMOVED***optional:!0});!s||(c=await s.getHeartbeatsHeader())&&o.append("x-firebase-client",c);var c=***REMOVED***installation:***REMOVED***sdkVersion:j,appId:t.appId}};const u=***REMOVED***method:"POST",headers:o,body:JSON.stringify(c)},f=await _(()=>fetch(r,u));if(f.ok)return O(await f.json());throw await A("Generate Auth Token",f)}async function ut(r,a=!1)***REMOVED***let i;var t=await at(r.appConfig,t=>***REMOVED***if(!pt(t))throw L.create("not-registered");var e,n=t.authToken;if(a||2!==(e=n).requestStatus||function(t)***REMOVED***var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+$}(e))***REMOVED***if(1===n.requestStatus)return i=async function(t,e)***REMOVED***let n=await ft(t.appConfig);for(;1===n.authToken.requestStatus;)await V(100),n=await ft(t.appConfig);var r=n.authToken;return 0===r.requestStatus?ut(t,e):r}(r,a),t;if(!navigator.onLine)throw L.create("app-offline");n=(e=t,n=***REMOVED***requestStatus:1,requestTime:Date.now()},Object.assign(Object.assign(***REMOVED***},e),***REMOVED***authToken:n}));return i=async function(e,n)***REMOVED***try***REMOVED***var r=await ct(e,n),t=Object.assign(Object.assign(***REMOVED***},n),***REMOVED***authToken:r});return await nt(e.appConfig,t),r}catch(t)***REMOVED***throw!q(t)||401!==t.customData.serverCode&&404!==t.customData.serverCode?(r=Object.assign(Object.assign(***REMOVED***},n),***REMOVED***authToken:***REMOVED***requestStatus:0}}),await nt(e.appConfig,r)):await rt(e.appConfig),t}}(r,n),n}return t});return i?await i:t.authToken}function ft(t)***REMOVED***return at(t,t=>***REMOVED***if(!pt(t))throw L.create("not-registered");var e,n=t.authToken;return 1===(e=n).requestStatus&&e.requestTime+E<Date.now()?Object.assign(Object.assign(***REMOVED***},t),***REMOVED***authToken:***REMOVED***requestStatus:0}}):t})}function pt(t)***REMOVED***return void 0!==t&&2===t.registrationStatus}async function dt(t)***REMOVED***var e=t;const***REMOVED***installationEntry:n,registrationPromise:r}=await it(e);return(r||ut(e)).catch(console.error),n.fid}async function lt(t,e=!1)***REMOVED***var n,r=t;return await((n=(await it(r)).registrationPromise)&&await n),(await ut(r,e)).token}async function gt(t,e)***REMOVED***const n=([r,a]=[t,e["fid"]],`$***REMOVED***N(r)}/$***REMOVED***a}`);var r,a;const i=***REMOVED***method:"DELETE",headers:x(t,e)};var o=await _(()=>fetch(n,i));if(!o.ok)throw await A("Delete Installation",o)}function ht(t,e)***REMOVED***const n=t["appConfig"];return function(t,e)***REMOVED***G();var n=R(t);let r=W.get(n);r||(r=new Set,W.set(n,r)),r.add(e)}(n,e),()=>***REMOVED***!function(t,e)***REMOVED***var n=R(t);const r=W.get(n);r&&(r.delete(e),0===r.size&&W.delete(n),Y())}(n,e)}}function vt(t)***REMOVED***return L.create("missing-app-config-values",***REMOVED***valueName:t})}const wt="installations",mt=t=>***REMOVED***var e=t.getProvider("app").getImmediate();return***REMOVED***app:e,appConfig:function(t)***REMOVED***if(!t||!t.options)throw vt("App Configuration");if(!t.name)throw vt("App Name");for(const e of["projectId","apiKey","appId"])if(!t.options[e])throw vt(e);return***REMOVED***appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e),heartbeatServiceProvider:St._getProvider(e,"heartbeat"),_delete:()=>Promise.resolve()}},yt=t=>***REMOVED***var e=t.getProvider("app").getImmediate();const n=St._getProvider(e,wt).getImmediate();return***REMOVED***getId:()=>dt(n),getToken:t=>lt(n,t)}};St._registerComponent(new n(wt,mt,"PUBLIC")),St._registerComponent(new n("installations-internal",yt,"PRIVATE")),St.registerVersion(T,k),St.registerVersion(T,k,"esm2017");class bt***REMOVED***constructor(t,e)***REMOVED***this.app=t,this._delegate=e}getId()***REMOVED***return dt(this._delegate)}getToken(t)***REMOVED***return lt(this._delegate,t)}delete()***REMOVED***return async function(t)***REMOVED***var e=t["appConfig"],n=await at(e,t=>***REMOVED***if(!t||0!==t.registrationStatus)return t});if(n)***REMOVED***if(1===n.registrationStatus)throw L.create("delete-pending-registration");if(2===n.registrationStatus)***REMOVED***if(!navigator.onLine)throw L.create("app-offline");await gt(e,n),await rt(e)}}}(this._delegate)}onIdChange(t)***REMOVED***return ht(this._delegate,t)}}(B=e.default).INTERNAL.registerComponent(new n("installations-compat",t=>***REMOVED***var e=t.getProvider("app-compat").getImmediate(),n=t.getProvider("installations").getImmediate();return new bt(e,n)},"PUBLIC")),B.registerVersion("@firebase/installations-compat","0.2.1")}).apply(this,arguments)}catch(t)***REMOVED***throw console.error(t),new Error("Cannot instantiate firebase-installations-compat.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-installations-compat.js.map
