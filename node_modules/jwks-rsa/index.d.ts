import ***REMOVED*** Agent as HttpAgent } from 'http';
import ***REMOVED*** Agent as HttpsAgent } from 'https';
import type ***REMOVED***Jwt, Secret} from 'jsonwebtoken'
import Express = require('express')

declare function JwksRsa(options: JwksRsa.Options): JwksRsa.JwksClient;

declare namespace JwksRsa ***REMOVED***
  class JwksClient ***REMOVED***
    constructor(options: Options);

    getKeys(): Promise<unknown>;
    getSigningKeys(): Promise<SigningKey[]>;
    getSigningKey(kid?: string | null | undefined): Promise<SigningKey>;
    getSigningKey(kid: string | null | undefined, cb: (err: Error | null, key?: SigningKey) => void): void;
***REMOVED***

  interface Headers ***REMOVED***
    [key: string]: string;
***REMOVED***

  interface Options ***REMOVED***
    jwksUri: string;
    rateLimit?: boolean;
    cache?: boolean;
    cacheMaxEntries?: number;
    cacheMaxAge?: number;
    jwksRequestsPerMinute?: number;
    proxy?: string;
    requestHeaders?: Headers;
    timeout?: number;
    requestAgent?: HttpAgent | HttpsAgent;
    fetcher?(jwksUri: string): Promise<***REMOVED*** keys: any }>;
    getKeysInterceptor?(): Promise<JSONWebKey[]>;
***REMOVED***

  interface JSONWebKey ***REMOVED***
    kid: string,
    alg: string,
    [key: string]: any
***REMOVED***

  interface CertSigningKey ***REMOVED***
    kid: string;
    alg: string;
    getPublicKey(): string;
    publicKey: string;
***REMOVED***

  interface RsaSigningKey ***REMOVED***
    kid: string;
    alg: string;
    getPublicKey(): string;
    rsaPublicKey: string;
***REMOVED***

  type SigningKey = CertSigningKey | RsaSigningKey;

  /**
   * Types are duplicated from express-jwt@6/7
   * due to numerous breaking changes in the lib's types
   * whilst this lib supportd both <=6 & >=7  implementations
   *
   * express-jwt's installed version (or its @types)
   * will be the types used at transpilation time
   */

  /** Types from express-jwt@<=6 */
  type secretType = string|Buffer;
  type SecretCallbackLong = (req: Express.Request, header: any, payload: any, done: (err: any, secret?: secretType) => void) => void;
  type SecretCallback = (req: Express.Request, payload: any, done: (err: any, secret?: secretType) => void) => void;

  /** Types from express-jwt@>=7 */
  type GetVerificationKey = (req: Express.Request, token: Jwt | undefined) => Secret | undefined | Promise<Secret | undefined>;

  function expressJwtSecret(options: ExpressJwtOptions): SecretCallbackLong|GetVerificationKey;

  function passportJwtSecret(options: ExpressJwtOptions): SecretCallback;

  interface ExpressJwtOptions extends Options ***REMOVED***
    handleSigningKeyError?: (err: Error | null, cb: (err: Error | null) => void) => void;
***REMOVED***

  function hapiJwt2Key(options: HapiJwtOptions): (decodedToken: DecodedToken, cb: HapiCallback) => void;

  interface HapiJwtOptions extends Options ***REMOVED***
    handleSigningKeyError?: (err: Error | null, cb: HapiCallback) => void;
***REMOVED***

  type HapiCallback = (err: Error | null, publicKey: string, signingKey: SigningKey) => void;

  interface DecodedToken ***REMOVED***
    header: TokenHeader;
***REMOVED***

  interface TokenHeader ***REMOVED***
    alg: string;
    kid: string;
***REMOVED***

  function hapiJwt2KeyAsync(options: HapiJwtOptions): (decodedToken: DecodedToken) => Promise<***REMOVED*** key: string }>;

  function koaJwtSecret(options: KoaJwtOptions): (header: TokenHeader) => Promise<string>;

  interface KoaJwtOptions extends Options ***REMOVED***
    handleSigningKeyError?(err: Error | null): Promise<void>;
***REMOVED***

  class ArgumentError extends Error ***REMOVED***
    name: 'ArgumentError';
    constructor(message: string);
***REMOVED***

  class JwksError extends Error ***REMOVED***
    name: 'JwksError';
    constructor(message: string);
***REMOVED***

  class JwksRateLimitError extends Error ***REMOVED***
    name: 'JwksRateLimitError';
    constructor(message: string);
***REMOVED***

  class SigningKeyNotFoundError extends Error ***REMOVED***
    name: 'SigningKeyNotFoundError';
    constructor(message: string);
***REMOVED***
}

export = JwksRsa;
