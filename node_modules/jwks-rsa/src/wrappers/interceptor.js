const retrieveSigningKeys = require('../utils').retrieveSigningKeys;

/**
 * Uses getKeysInterceptor to allow users to retrieve keys from a file,
 * external cache, or provided object before falling back to the jwksUri endpoint
 */
function getKeysInterceptor(client, ***REMOVED*** getKeysInterceptor }) ***REMOVED***
  const getSigningKey = client.getSigningKey.bind(client);

  return async (kid) => ***REMOVED***
    const keys = await getKeysInterceptor();

    let signingKeys;
    if (keys && keys.length) ***REMOVED***
      signingKeys = await retrieveSigningKeys(keys);
  ***REMOVED***

    if (signingKeys && signingKeys.length) ***REMOVED***
      const key = signingKeys.find(k => !kid || k.kid === kid);

      if (key) ***REMOVED***
        return key;
    ***REMOVED***
  ***REMOVED***

    return getSigningKey(kid);
***REMOVED***;
}

module.exports.default = getKeysInterceptor;
