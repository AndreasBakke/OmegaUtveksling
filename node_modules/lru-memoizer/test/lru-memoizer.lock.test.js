const memoizer = require('./..');
const assert   = require('chai').assert;
const _        = require('lodash');

describe('lru-simultaneos calls', function () ***REMOVED***
  var loadTimes = 0, memoized;

  beforeEach(function () ***REMOVED***
    loadTimes = 0;

    memoized = memoizer(***REMOVED***
      load: function (a, b, callback) ***REMOVED***
        loadTimes++;
        setTimeout(function () ***REMOVED***
          callback(null, a + b);
      ***REMOVED***, 100);
    ***REMOVED***,
      hash: function (a, b) ***REMOVED***
        return a + '-' + b;
    ***REMOVED***,
      max: 10
  ***REMOVED***);
***REMOVED***);

  it('should call once', function (done) ***REMOVED***
    memoized(1, 2, _.noop);
    memoized(1, 2, _.noop);
    memoized(1, 2, function (err, result) ***REMOVED***
      if (err) ***REMOVED*** return done(err); }
      assert.strictEqual(loadTimes, 1);
      assert.strictEqual(result, 3);
      done();
  ***REMOVED***);
***REMOVED***);

});
