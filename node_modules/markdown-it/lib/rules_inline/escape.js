// Process escaped chars and hardbreaks

'use strict';

var isSpace = require('../common/utils').isSpace;

var ESCAPED = [];

for (var i = 0; i < 256; i++) ***REMOVED*** ESCAPED.push(0); }

'\\!"#$%&\'()*+,./:;<=>?@[]^_`***REMOVED***|}~-'
  .split('').forEach(function (ch) ***REMOVED*** ESCAPED[ch.charCodeAt(0)] = 1; });


module.exports = function escape(state, silent) ***REMOVED***
  var ch, pos = state.pos, max = state.posMax;

  if (state.src.charCodeAt(pos) !== 0x5C/* \ */) ***REMOVED*** return false; }

  pos++;

  if (pos < max) ***REMOVED***
    ch = state.src.charCodeAt(pos);

    if (ch < 256 && ESCAPED[ch] !== 0) ***REMOVED***
      if (!silent) ***REMOVED*** state.pending += state.src[pos]; }
      state.pos += 2;
      return true;
  ***REMOVED***

    if (ch === 0x0A) ***REMOVED***
      if (!silent) ***REMOVED***
        state.push('hardbreak', 'br', 0);
    ***REMOVED***

      pos++;
      // skip leading whitespaces from next line
      while (pos < max) ***REMOVED***
        ch = state.src.charCodeAt(pos);
        if (!isSpace(ch)) ***REMOVED*** break; }
        pos++;
    ***REMOVED***

      state.pos = pos;
      return true;
  ***REMOVED***
***REMOVED***

  if (!silent) ***REMOVED*** state.pending += '\\'; }
  state.pos++;
  return true;
};
