// Parse link title
//
'use strict';


var unescapeAll = require('../common/utils').unescapeAll;


module.exports = function parseLinkTitle(str, pos, max) ***REMOVED***
  var code,
      marker,
      lines = 0,
      start = pos,
      result = ***REMOVED***
        ok: false,
        pos: 0,
        lines: 0,
        str: ''
    ***REMOVED***;

  if (pos >= max) ***REMOVED*** return result; }

  marker = str.charCodeAt(pos);

  if (marker !== 0x22 /* " */ && marker !== 0x27 /* ' */ && marker !== 0x28 /* ( */) ***REMOVED*** return result; }

  pos++;

  // if opening marker is "(", switch it to closing marker ")"
  if (marker === 0x28) ***REMOVED*** marker = 0x29; }

  while (pos < max) ***REMOVED***
    code = str.charCodeAt(pos);
    if (code === marker) ***REMOVED***
      result.pos = pos + 1;
      result.lines = lines;
      result.str = unescapeAll(str.slice(start + 1, pos));
      result.ok = true;
      return result;
  ***REMOVED*** else if (code === 0x28 /* ( */ && marker === 0x29 /* ) */) ***REMOVED***
      return result;
  ***REMOVED*** else if (code === 0x0A) ***REMOVED***
      lines++;
  ***REMOVED*** else if (code === 0x5C /* \ */ && pos + 1 < max) ***REMOVED***
      pos++;
      if (str.charCodeAt(pos) === 0x0A) ***REMOVED***
        lines++;
    ***REMOVED***
  ***REMOVED***

    pos++;
***REMOVED***

  return result;
};
