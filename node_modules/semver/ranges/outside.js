const SemVer = require('../classes/semver')
const Comparator = require('../classes/comparator')
const ***REMOVED*** ANY } = Comparator
const Range = require('../classes/range')
const satisfies = require('../functions/satisfies')
const gt = require('../functions/gt')
const lt = require('../functions/lt')
const lte = require('../functions/lte')
const gte = require('../functions/gte')

const outside = (version, range, hilo, options) => ***REMOVED***
  version = new SemVer(version, options)
  range = new Range(range, options)

  let gtfn, ltefn, ltfn, comp, ecomp
  switch (hilo) ***REMOVED***
    case '>':
      gtfn = gt
      ltefn = lte
      ltfn = lt
      comp = '>'
      ecomp = '>='
      break
    case '<':
      gtfn = lt
      ltefn = gte
      ltfn = gt
      comp = '<'
      ecomp = '<='
      break
    default:
      throw new TypeError('Must provide a hilo val of "<" or ">"')
***REMOVED***

  // If it satisfies the range it is not outside
  if (satisfies(version, range, options)) ***REMOVED***
    return false
***REMOVED***

  // From now on, variable terms are as if we're in "gtr" mode.
  // but note that everything is flipped for the "ltr" function.

  for (let i = 0; i < range.set.length; ++i) ***REMOVED***
    const comparators = range.set[i]

    let high = null
    let low = null

    comparators.forEach((comparator) => ***REMOVED***
      if (comparator.semver === ANY) ***REMOVED***
        comparator = new Comparator('>=0.0.0')
    ***REMOVED***
      high = high || comparator
      low = low || comparator
      if (gtfn(comparator.semver, high.semver, options)) ***REMOVED***
        high = comparator
    ***REMOVED*** else if (ltfn(comparator.semver, low.semver, options)) ***REMOVED***
        low = comparator
    ***REMOVED***
  ***REMOVED***)

    // If the edge version comparator has a operator then our version
    // isn't outside it
    if (high.operator === comp || high.operator === ecomp) ***REMOVED***
      return false
  ***REMOVED***

    // If the lowest version comparator has an operator and our version
    // is less than it then it isn't higher than the range
    if ((!low.operator || low.operator === comp) &&
        ltefn(version, low.semver)) ***REMOVED***
      return false
  ***REMOVED*** else if (low.operator === ecomp && ltfn(version, low.semver)) ***REMOVED***
      return false
  ***REMOVED***
***REMOVED***
  return true
}

module.exports = outside
