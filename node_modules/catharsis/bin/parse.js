#!/usr/bin/env node

// Command-line tool that parses a type expression and dumps a JSON version of the parse tree.
const catharsis = require('../catharsis');
const path = require('path');
const util = require('util');

const command = path.basename(process.argv[1]);
const typeExpression = process.argv[2];
const opts = ***REMOVED***
    describe: false,
    jsdoc: false
};
let parsedType;

function usage() ***REMOVED***
    console.log(util.format('Usage:\n    %s typeExpression [--jsdoc] [--describe]', command));
}

function done(err) ***REMOVED***
    /* eslint-disable no-process-exit */
    process.exit(err === undefined ? 0 : err);
    /* eslint-enable no-process-exit */
}

process.argv.slice(3).forEach(arg => ***REMOVED***
    const parsedArg = arg.replace(/^-***REMOVED***2}/, '');

    if (opts[parsedArg] !== undefined) ***REMOVED***
        opts[parsedArg] = true;
  ***REMOVED*** else ***REMOVED***
        console.error('Unknown option "%s"', arg);
        usage();
        done(1);
  ***REMOVED***
});

if (!typeExpression) ***REMOVED***
    usage();
    done(1);
} else ***REMOVED***
    try ***REMOVED***
        parsedType = catharsis.parse(typeExpression, opts);
        if (opts.describe) ***REMOVED***
            parsedType = catharsis.describe(parsedType);
      ***REMOVED***
  ***REMOVED*** catch (e) ***REMOVED***
        console.error(util.format('Unable to parse "%s" (exception follows):', typeExpression));
        console.error(e.stack || e.message);
        done(1);
  ***REMOVED***

    console.log(JSON.stringify(parsedType, null, 2));
    done();
}
