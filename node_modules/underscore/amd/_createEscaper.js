define(['./keys'], function (keys) ***REMOVED***

  // Internal helper to generate functions for escaping and unescaping strings
  // to/from HTML interpolation.
  function createEscaper(map) ***REMOVED***
    var escaper = function(match) ***REMOVED***
      return map[match];
  ***REMOVED***;
    // Regexes for identifying a key that needs to be escaped.
    var source = '(?:' + keys(map).join('|') + ')';
    var testRegexp = RegExp(source);
    var replaceRegexp = RegExp(source, 'g');
    return function(string) ***REMOVED***
      string = string == null ? '' : '' + string;
      return testRegexp.test(string) ? string.replace(replaceRegexp, escaper) : string;
  ***REMOVED***;
***REMOVED***

  return createEscaper;

});
