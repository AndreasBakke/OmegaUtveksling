/**
 * @module plugins/sourcetag
 */
const logger = require('jsdoc/util/logger');

exports.handlers = ***REMOVED***
    /**
     * Support @source tag. Expected value like:
     *
     *     ***REMOVED*** "filename": "myfile.js", "lineno": 123 }
     *
     * Modifies the corresponding meta values on the given doclet.
     *
     * WARNING: If you are using a JSDoc template that generates pretty-printed source files,
     * such as JSDoc's default template, this plugin can cause JSDoc to crash. To fix this issue,
     * update your template settings to disable pretty-printed source files.
     *
     * @source ***REMOVED*** "filename": "sourcetag.js", "lineno": 9 }
     */
    newDoclet(***REMOVED***doclet}) ***REMOVED***
        let tags = doclet.tags;
        let tag;
        let value;

        // any user-defined tags in this doclet?
        if (typeof tags !== 'undefined') ***REMOVED***
            // only interested in the @source tags
            tags = tags.filter((***REMOVED***title}) => title === 'source');

            if (tags.length) ***REMOVED***
                // take the first one
                tag = tags[0];

                try ***REMOVED***
                    value = JSON.parse(tag.value);
              ***REMOVED***
                catch (ex) ***REMOVED***
                    logger.error('@source tag expects a valid JSON value, like ***REMOVED*** "filename": "myfile.js", "lineno": 123 }.');

                    return;
              ***REMOVED***

                doclet.meta = doclet.meta || ***REMOVED***};
                doclet.meta.filename = value.filename || '';
                doclet.meta.lineno = value.lineno || '';
          ***REMOVED***
      ***REMOVED***
  ***REMOVED***
};
