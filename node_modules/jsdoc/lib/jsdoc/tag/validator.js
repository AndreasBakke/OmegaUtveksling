/**
 * @module jsdoc/tag/validator
 * @requires jsdoc/tag/dictionary
 */
const env = require('jsdoc/env');
const logger = require('jsdoc/util/logger');

function buildMessage(tagName, ***REMOVED***filename, lineno, comment}, desc) ***REMOVED***
    let result = `The @$***REMOVED***tagName} tag $***REMOVED***desc}. File: $***REMOVED***filename}, line: $***REMOVED***lineno}`;

    if (comment) ***REMOVED***
        result += `\n$***REMOVED***comment}`;
  ***REMOVED***

    return result;
}

/**
 * Validate the given tag.
 */
exports.validate = (***REMOVED***title, text, value}, tagDef, meta) => ***REMOVED***
    const allowUnknownTags = env.conf.tags.allowUnknownTags;

    // handle cases where the tag definition does not exist
    if (!tagDef) ***REMOVED***
        // log an error if unknown tags are not allowed
        if (!allowUnknownTags ||
            (Array.isArray(allowUnknownTags) &&
             !allowUnknownTags.includes(title))) ***REMOVED***
            logger.error( buildMessage(title, meta, 'is not a known tag') );
      ***REMOVED***

        // stop validation, since there's nothing to validate against
        return;
  ***REMOVED***

    // check for errors that make the tag useless
    if (!text && tagDef.mustHaveValue) ***REMOVED***
        logger.error( buildMessage(title, meta, 'requires a value') );
  ***REMOVED***

    // check for minor issues that are usually harmless
    else if (text && tagDef.mustNotHaveValue) ***REMOVED***
        logger.warn( buildMessage(title, meta,
            'does not permit a value; the value will be ignored') );
  ***REMOVED***
    else if (value && value.description && tagDef.mustNotHaveDescription) ***REMOVED***
        logger.warn( buildMessage(title, meta,
            'does not permit a description; the description will be ignored') );
  ***REMOVED***
};
