/**
 * @module jsdoc/src/scanner
 * @requires module:jsdoc/fs
 */
const EventEmitter = require('events').EventEmitter;
const env = require('jsdoc/env');
const fs = require('jsdoc/fs');
const logger = require('jsdoc/util/logger');
const path = require('jsdoc/path');

/**
 * @extends module:events.EventEmitter
 */
class Scanner extends EventEmitter ***REMOVED***
    constructor() ***REMOVED***
        super();
  ***REMOVED***

    /**
     * Recursively searches the given searchPaths for js files.
     * @param ***REMOVED***Array.<string>} searchPaths
     * @param ***REMOVED***number} [depth]
     * @fires sourceFileFound
     */
    scan(searchPaths = [], depth = 1, filter) ***REMOVED***
        let currentFile;
        let filePaths = [];

        searchPaths.forEach($ => ***REMOVED***
            const filepath = path.resolve( env.pwd, decodeURIComponent($) );

            try ***REMOVED***
                currentFile = fs.statSync(filepath);
          ***REMOVED***
            catch (e) ***REMOVED***
                logger.error('Unable to find the source file or directory %s', filepath);

                return;
          ***REMOVED***

            if ( currentFile.isFile() ) ***REMOVED***
                filePaths.push(filepath);
          ***REMOVED***
            else ***REMOVED***
                filePaths = filePaths.concat( fs.ls(filepath, depth) );
          ***REMOVED***
      ***REMOVED***);

        filePaths = filePaths.filter($ => filter.isIncluded($));

        filePaths = filePaths.filter($ => ***REMOVED***
            const e = ***REMOVED*** fileName: $ };

            this.emit('sourceFileFound', e);

            return !e.defaultPrevented;
      ***REMOVED***);

        return filePaths;
  ***REMOVED***
}
exports.Scanner = Scanner;
